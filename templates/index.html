<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Lijero Crypto Signals Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f6f8; padding: 20px; }
        h1 { text-align: center; margin-bottom: 15px; color: #2c3e50; }
        table { width: 90%; margin: auto; border-collapse: collapse; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        th, td { padding: 12px 15px; text-align: center; border-bottom: 1px solid #ddd; }
        th { background-color: #2c3e50; color: white; }
        tr:hover { background-color: #f1f1f1; }
        .signal-buy { color: #27ae60; font-weight: bold; }
        .signal-sell { color: #c0392b; font-weight: bold; }
        .signal-hold { color: #7f8c8d; font-weight: bold; }
        .prob-bar { height: 16px; border-radius: 8px; background: #ddd; margin: auto; position: relative; width: 80%; }
        .prob-fill { height: 100%; border-radius: 8px; text-align: center; color: white; font-size: 12px; line-height: 16px; }
        #updateBtn { display: block; margin: 20px auto; padding: 10px 25px; font-size: 16px; cursor: pointer; background-color: #3498db; color: white; border: none; border-radius: 5px; }
        #updateBtn:hover { background-color: #2980b9; }
        #lastUpdate { text-align: center; margin-top: 10px; font-size: 14px; color: #555; }
        #errorMsg { text-align: center; color: #c0392b; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>üìä Lijero Crypto Signals Dashboard</h1>
    <button id="updateBtn">üîÑ Actualizar Ahora</button>
    <table>
        <thead>
            <tr>
                <th>S√≠mbolo</th>
                <th>Precio</th>
                <th>Se√±al</th>
                <th>Probabilidad</th>
                <th>Confirmaciones</th>
                <th>√öltima actualizaci√≥n</th>
            </tr>
        </thead>
        <tbody id="signalsTable">
            <tr><td colspan="6">Cargando...</td></tr>
        </tbody>
    </table>
    <div id="errorMsg"></div>

    <script>
        const API_URL = "http://127.0.0.1:5000/api/signals";
        const REFRESH_INTERVAL = 60 * 1000; // cada 60 segundos

        async function fetchSignals() {
            const tableBody = document.getElementById("signalsTable");
            const errorDiv = document.getElementById("errorMsg");
            tableBody.innerHTML = "<tr><td colspan='6'>Cargando...</td></tr>";
            errorDiv.textContent = "";

            try {
                const res = await fetch(API_URL);
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const data = await res.json();

                if (!Array.isArray(data) || data.length === 0) {
                    tableBody.innerHTML = "<tr><td colspan='6'>‚ö†Ô∏è No hay datos</td></tr>";
                    return;
                }

                tableBody.innerHTML = "";
                data.forEach(row => {
                    const tr = document.createElement("tr");

                    if (row.signal.includes("BUY")) tr.style.backgroundColor = "#e8f8f5";
                    else if (row.signal.includes("SELL")) tr.style.backgroundColor = "#fdecea";
                    else tr.style.backgroundColor = "#f0f0f0";

                    const tdSym = `<td>${row.symbol}</td>`;
                    const tdPrice = `<td>$${row.price}</td>`;
                    const tdSignal = `<td class="${row.signal.includes('BUY') ? 'signal-buy' : row.signal.includes('SELL') ? 'signal-sell' : 'signal-hold'}">${row.signal}</td>`;
                    const tdProb = `
                        <td>
                            <div class='prob-bar'>
                                <div class='prob-fill' style='width:${row.prob*100}%;background:${row.signal.includes('BUY') ? '#27ae60' : row.signal.includes('SELL') ? '#c0392b' : '#7f8c8d'}'>
                                    ${(row.prob*100).toFixed(1)}%
                                </div>
                            </div>
                        </td>`;
                    const tdConf = `<td>${row.confirmations}</td>`;
                    const tdTime = `<td>${row.timestamp}</td>`;

                    tr.innerHTML = tdSym + tdPrice + tdSignal + tdProb + tdConf + tdTime;
                    tableBody.appendChild(tr);
                });

            } catch (err) {
                console.error(err);
                errorDiv.textContent = "‚ùå Error al obtener se√±ales: " + err.message;
            }
        }

        fetchSignals();
        document.getElementById("updateBtn").addEventListener("click", fetchSignals);
        setInterval(fetchSignals, REFRESH_INTERVAL);
    </script>
</body>
</html>
